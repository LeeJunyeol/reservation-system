"use strict";function Flicking(t,e){var n={width:0,intervalFlag:!0,startX:0,startY:0};this.$list=t,this.options=$.extend({},n,e),this.afterFlickFn=this.options.afterFlickFn,this.getWidth=function(){return this.options.width},this.getStartX=function(){return this.options.startX},this.setStartX=function(t){this.options.startX=t},this.getStartY=function(){return this.options.startY},this.setStartY=function(t){this.options.startY=t},this.getIntervalFlag=function(){return this.options.intervalFlag}}function TicketValidator(){}function Ticket(){}function extend(t,e){var n=function(){t.apply(this,arguments),"function"==typeof e.init&&e.init.apply(this,arguments)},a=function(){};a.prototype=t.prototype;var i=new a;for(var o in e)i[o]=e[o];return i.constructor=n,n.prototype=i,n}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_slicedToArray=function(){function t(t,e){var n=[],a=!0,i=!1,o=void 0;try{for(var r,l=t[Symbol.iterator]();!(a=(r=l.next()).done)&&(n.push(r.value),!e||n.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),categoryAdmin=function(){var t=function(t,e){$("#category_list .modifyBtn").prop("disabled",!0);var n=t.find(".modifyBtn"),a=t.find(".removeBtn"),i=t.find(".modifyConfirmBtn"),o=t.find(".modifyCancleBtn");e.prop("readonly",!1),e.focus(),n.hide(),a.hide(),i.show(),o.show()},e=function(t,e){e.prop("readonly",!0),$("#category_list .modifyBtn").prop("disabled",!1);var n=t.find(".modifyBtn"),a=t.find(".removeBtn"),i=t.find(".modifyConfirmBtn"),o=t.find(".modifyCancleBtn");n.show(),a.show(),i.hide(),o.hide()};return{removeBtnListener:function(t){if($(t.target).hasClass("removeBtn")){var e=t.target.parentNode,n=e.dataset.id;$.ajax({url:"/api/categories/"+n,type:"DELETE"}).done(function(){e.parentNode.removeChild(e)}).fail(function(t){console.log(t.responseJSON),alert("Category 삭제를 실패했습니다.")})}},modifyBtnListener:function(e){var n=$(e.target).parent(),a=n.find(".categoryName");t(n,a)},modifyConfirmBtnListener:function(t){var n=$(t.target).parent(),a=n.find(".categoryName"),i=n.data("id"),o=a.val();if(o&&0!==o.trim().length){var r=JSON.stringify({name:o});$.ajax({url:"/api/categories/"+i,type:"PUT",data:r,contentType:"application/json"}).done(function(){a.prop("defaultValue",o),e(n,a)}).fail(function(t){console.log(t.responseJSON),e(n,a),alert("Category update를 실패했습니다.")})}else a.val(a.prop("defaultValue")),e(n,a),alert("공백은 입력할 수 없습니다.")},modifyCancleBtnListener:function(t){var n=$(t.target).parent(),a=n.find(".categoryName");a.val(a.prop("defaultValue")),e(n,a)}}}();$("#category_list").on("click",categoryAdmin.removeBtnListener),$("#category_list").on("click",".modifyBtn",categoryAdmin.modifyBtnListener),$("#category_list").on("click",".modifyConfirmBtn",categoryAdmin.modifyConfirmBtnListener),$("#category_list").on("click",".modifyCancleBtn",categoryAdmin.modifyCancleBtnListener);var CURRENT_URL=window.location.href,productName,productDesc,ProductDetail=function(t){var e=$("#container").data("id"),n=$("#container ul.visual_img"),a=$("span[class=num]"),i=$(".btn_prev"),o=$(".btn_nxt"),r=$(".btn_goto_home"),l=$(".btn_goto_tel"),c=$(".btn_goto_mail"),s=$(".btn_goto_path"),d=$(".bk_more._open"),u=$(".bk_more._close"),p=$(".bk_btn"),m=$(".item._detail"),f=$(".item._path"),h=$(".detail_area_wrap"),v=$(".detail_location"),g=$(".box_store_info"),y=$(".store_location"),_=$(".btn_path"),b=new Flicking(n,{width:414,intervalFlag:!1,afterFlickFn:function(){a.html(this.$list.data("curItem"))}});b.detectClick(i,"prev"),b.detectClick(o,"next"),b.swipedetect($(".group_visual"));var k=function(t){$.ajax({url:"/api/products/"+e+"/detail",type:"GET"}).done(function(e){productName=e.name,productDesc=e.description;var n=$("#description-template").html(),a=Handlebars.compile(n),i=a(e);$(".store_details.close3").append(i);var n=$("#event-template").html(),i=(a=Handlebars.compile(n))(e);$(".event_info").append(i);var n=$("#content-template").html(),i=(a=Handlebars.compile(n))(e);$(".detail_info_group").append(i),t()}).fail(function(t){console.log(t.responseJSON),alert("Product detail load를 실패했습니다.")})},w=function(){$.ajax({url:"/api/products/"+e+"/subImage",type:"GET"}).done(function(t){var e=$("#detail-image-template").html(),n=Handlebars.compile(e)(t);$(".detail_info_group").append(n),Lazy.init()}).fail(function(t){console.log(t.responseJSON)})},C=function(t){naver.maps.Service.geocode({address:t},function(t,e){naver.maps.Service.Status.ERROR;var n=e.result.items[0],a=new naver.maps.Point(n.point.x,n.point.y),i=new naver.maps.Map("map",{center:new naver.maps.LatLng(a.y,a.x),zoom:10});new naver.maps.Marker({position:new naver.maps.LatLng(a.y,a.x),map:i});y.on("click",function(t){var e="http://map.naver.com/index.nhn?enc=utf8&level=2&lng="+a.x+"&lat="+a.y+"&pinTitle="+$(".store_addr.addr_detail").html()+"&pinType=SITE";window.open(e)});var o="http://map.naver.com/?&enc=utf8&dtPathType=0&menu=route&mapMode=0&pathType=1&elng="+a.x+"&elat="+a.y+"&eText="+$(".store_addr.addr_detail").html();_.on("click",function(t){var e=o;window.open(e)}),s.attr("href",o)})},T=function(){$.ajax({url:"/api/products/"+e+"/displayInfo",type:"GET"}).done(function(t){t.productName=productName;var e=$("#location-template").html(),n=Handlebars.compile(e)(t);g.append(n),C(t.placeStreet),r.attr("href",t.homepage),l.attr("href","tel:"+t.tel),c.attr("href","mailto:"+t.email)}).fail(function(t){console.log(t.responseJSON),alert("Display info load를 실패했습니다.")})},x=function(t){var e=Handlebars.compile($("#main-images-template").html());n.append(e(t))},S=function(t){n.data("curItem",1),$.ajax({url:"/api/products/"+e+"/images?type=0",type:"GET"}).done(function(e){x(e),t(n);var a=$(".visual_txt_tit span"),i=$(".visual_txt_dsc"),o=$(".num.off");a.eq(1).html(productName),i.eq(1).html(productDesc),a.eq(-1).html(productName),i.eq(-1).html(productDesc),o.html("/ <span>"+e.length+"</span>")}).fail(function(t){console.log(t.responseJSON),alert("Main image list load를 실패했습니다.")})},R=function(t){t.preventDefault(),$(".store_details").toggleClass("close3"),d.toggle(),u.toggle()},E=function(t){m.find("a.anchor").addClass("active"),f.find("a.anchor").removeClass("active"),h.removeClass("hide"),v.addClass("hide"),t.preventDefault()},I=function(t){f.find("a.anchor").addClass("active"),m.find("a.anchor").removeClass("active"),h.addClass("hide"),v.removeClass("hide"),t.preventDefault()},N=function(t){$.ajax({url:"/api/products/"+e+"/detail",type:"GET"}).done(function(t){console.log(JSON.stringify(t)),console.log(Date.now()),t.salesEnd<Date.now()?alert("판매기간 종료"):0===t.salesFlag?alert("매진"):location.href="/products/"+e+"/reservation"}).fail(function(t){console.log(t.responseJSON),alert("Product detail load를 실패했습니다.")})};return{init:function(){k(S.bind(this,b.listInit.bind(b))),w(),T(),d.on("click",R),u.on("click",R),p.on("click",N),m.on("click",E),f.on("click",I)}}}(),Comment=function(){var t=$("#container").data("id"),e=$(".grade_area .text_value span"),n=$(".grade_area .join_count em"),a=$("#photoviwer"),i=$(".photo_list"),o=$(".index_photo"),r=new Flicking(i,{width:$(window).width(),intervalFlag:!1,afterFlickFn:function(){o.html(this.$list.data("curItem"))}});r.swipedetect(i);var l=function(){$.ajax({url:"/api/products/"+t+"/comments/summary",type:"GET"}).done(function(t){e.html(t.avgScore.toFixed(1)),n.html(t.num+"건"),t.num>3&&$(".btn_review_more").show();var a=t.avgScore/5*100;$(".graph_value").css("width",a+"%")}).fail(function(t){console.log(t.responseJSON)})},c=function(t,e){$.ajax({url:"/api/comments/"+$(e.target).closest("li").data("id")+"/images",type:"GET"}).done(function(e){i.empty(),i.data("curItem",1);var n=$("#photo-viewer-template").html(),o=Handlebars.compile(n)(e);i.append(o),$(".total_photo").html(e.length),a.css({width:$(document).width(),height:$(document).height()}),a.fadeIn(),Lazy.disable(),t()}).fail(function(t){console.log(t.responseJSON),alert("Comment photos load를 실패했습니다.")})},s=function(e){$.ajax({url:"/api/products/"+t+"/comments",type:"GET"}).done(function(t){$.each(t,function(t,e){e.productName=productName;var n=new Date(e.createDate),a=n.getFullYear()+"."+(n.getMonth()+1)+"."+n.getDate();e.date=a;var i=$("#comment-template").html(),o=Handlebars.compile(i)(e);$(".list_short_review").append(o)}),$(".thumb").on("click",c.bind(this,e)),$(".btnPhotoviwerExit").on("click",function(){a.fadeOut(),Lazy.init()})}).fail(function(t){console.log(t.responseJSON),alert("Comments load를 실패했습니다.")})},d=function(t){t.preventDefault(),window.location.href=CURRENT_URL+"/comments"};return{init:function(){l(),s(r.listInit.bind(r)),$(".btn_review_more").on("click",d)}}}();$(function(){ProductDetail.init(),Comment.init()}),Flicking.prototype.swipedetect=function(t){t.on("mousedown touchstart",function(t){var e="mousedown"===t.type?t:t.originalEvent.changedTouches[0];this.setStartX(e.pageX),this.setStartY(e.pageY)}.bind(this)),t.on("mouseup touchend",function(t){var e="mouseup"===t.type?t:t.originalEvent.changedTouches[0],n=e.pageX-this.getStartX(),a=e.pageY-this.getStartY();Math.abs(n)>=50&&Math.abs(a)<=150&&(n<0?this.flick("next"):this.flick("prev"))}.bind(this))},Flicking.prototype.leftRollup=function(){var t=this.$list,e=t.children().length-2,n=t.data("curItem");n==e&&(t.css("left","0px"),n=0),t.animate({left:"-="+this.getWidth()+"px"}),t.data("curItem",n+1)},Flicking.prototype.rightRollup=function(){var t=this.$list,e=t.children().length,n=-1*(e-1)*this.getWidth(),a=t.data("curItem");1==a&&(t.css("left",+n+"px"),a=e-1),t.animate({left:"+="+this.getWidth()+"px"}),t.data("curItem",a-1)},Flicking.prototype.setFlickingInterval=function(){this.getIntervalFlag()&&(this.intervalId=setInterval(this.leftRollup.bind(this),2e3))},Flicking.prototype.clearFlickingInterval=function(){clearInterval(this.intervalId)},Flicking.prototype.listInit=function(){var t=this.$list,e=t.children().last().clone(),n=t.children().first().clone();t.append(n),t.prepend(e),t.css("left","-"+this.getWidth()+"px"),this.setFlickingInterval(),$(window).focus(this.setFlickingInterval.bind(this)),$(window).blur(this.clearFlickingInterval.bind(this))},Flicking.prototype.flick=function(t){var e="prev"===t?this.rightRollup:this.leftRollup;this.btnClicked||(this.btnClicked=!0,setTimeout(function(){this.btnClicked=!1}.bind(this),1e3),clearInterval(this.intervalId),clearTimeout(this.timeoutId),e.call(this),this.timeoutId=setTimeout(this.setFlickingInterval.bind(this),4e3),this.afterFlickFn&&this.afterFlickFn())},Flicking.prototype.detectClick=function(t,e){t.on("click",this.flick.bind(this,e))};var Navigation=function(){var t=function(t){t.preventDefault(),window.location.href=window.location.origin},e=function(t){t.preventDefault(),window.location.href="https://m.naver.com"},n=function(t){t.preventDefault(),window.location.href=window.location.origin+"/myreservation"};return{init:function(a){$(a).find('.lnk_logo[title="네이버"]').on("click",e),$(a).find('.lnk_logo[title="예약"]').on("click",t),$(a).find(".btn_my").on("click",n)}}}();$(function(){Navigation.init(".header")});var Lazy=function(){var t=function(t){var e=t.getBoundingClientRect();return e.bottom>=0&&e.right>=0&&e.top<=(window.innerHeight||document.documentElement.clientHeight)&&e.left<=(window.innerWidth||document.documentElement.clientWidth)},e=function(){var e=$(".detail_area_wrap .img_thumb");if(t(e[0])){var n=e.data("lazy-image");e.attr("src",n)}};return{init:function(){window.addEventListener("load",e),window.addEventListener("scroll",e),window.addEventListener("resize",e)},disable:function(){window.removeEventListener("load",e),window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}}(),ReservationMain=function(){var t="http://220.230.112.236/api/images/",e=$("#container ul.visual_img"),n=$("#container ul.event_tab_lst"),a=$("#container ul.lst_event_box"),i=$("#container p.event_lst_txt span.pink"),o=$("#container .btn_pre_e"),r=$("#container .btn_nxt_e, #container .nxt_fix"),l=$("#container .more button.btn"),c=0,s=0,d=!1,u=function(t){var e=$("#categories-template").html(),a=Handlebars.compile(e)({categories:t});n.append(a)},p=Handlebars.compile($("#product-template").html()),m=function(t){var e=a.eq(s%2);s++;var n=p({product:t});e.append(n)},f=function(t){var n=Handlebars.compile($("#promotions-template").html());e.append(n(t))},h=function(t,e){$.each(t,function(t,n){$.ajax({url:"/api/products/"+n.id+"/mainImage",type:"GET"}).done(e.bind(this,n.id)).fail(function(t){console.log(t.responseJSON),alert("Product main image load를 실패했습니다.")})})},v=function(n){e.data("curItem",1),$.ajax({url:"/api/products",type:"GET"}).done(function(a){f(a),n(e),h(a,function(e,n){-1!==n&&$(".visual_img li[data-id="+e+"]").css("background-image","url("+t+n+")")})}).fail(function(t){console.log(t.responseJSON),alert("Promotion list load를 실패했습니다.")})},g=function(){var e,n=$("#container ul.event_tab_lst a.anchor.active").closest(".item").data("category");e=(e=0==n?"/api/products":"/api/categories/"+n+"/products")+"?page="+(c+1),d=!0,$.ajax({url:e,type:"GET"}).done(function(e){e.length>0?(c++,$.each(e,function(t,e){m(e)}),h(e,function(e,n){-1!==n&&$(".lst_event_box li[data-id="+e+"] img").attr("src",t+n)})):l.hide(),d=!1}).fail(function(t){console.log(t.responseJSON),alert("Product list load를 실패했습니다.")})},y=function(){$.ajax({url:"/api/categories",type:"GET"}).done(u).fail(function(t){console.log(t.responseJSON),alert("Category list load를 실패했습니다.")})},_=function(t){i.text(t+"개")},b=function(){var t,e=$("#container ul.event_tab_lst a.anchor.active").closest(".item").data("category");t=0==e?"/api/products/count":"/api/categories/"+e+"/products/count",$.ajax({url:t,type:"GET"}).done(function(t){_(t)}).fail(function(t){console.log(t.responseJSON),alert("Products count load를 실패했습니다.")})},k=function(e){e.preventDefault();var i,o=$(e.target).closest("a.anchor"),r=$(e.target).closest("li.item").data("category");i=0==r?"/api/products":"/api/categories/"+r+"/products",i+="?page=1",$.ajax({url:i,type:"GET"}).done(function(e){n.find("a.anchor").removeClass("active"),o.addClass("active"),b(),a.empty(),s=0,c=1,$.each(e,function(t,e){m(e)}),h(e,function(e,n){-1!==n&&$(".lst_event_box li[data-id="+e+"] img").attr("src",t+n)}),e.length>0?l.show():l.hide()}).fail(function(t){console.log(t.responseJSON),alert("Products list load를 실패했습니다.")})},w=function(){"none"!==l.css("display")&&g()};return{init:function(){var t=new Flicking($("#container ul.visual_img"),{width:338});v(t.listInit.bind(t)),g(),y(),b(),t.detectClick(o,"prev"),t.detectClick(r,"next"),t.swipedetect($(".group_visual")),n.on("click","a",k),l.on("click",w),$(window).scroll(function(){!d&&$(window).scrollTop()>$(document).height()-$(window).height()-100&&w()})}}}();$(ReservationMain.init),$(function(){MyReservationModule.init()});var reservatinosForTest={canceledReservationCount:1,completedReservationCount:1,scheduledReservationCount:2,totalReservationCount:4,reservations:{1:[{id:1,childTicketCount:0,displayEnd:148405984e4,displayStart:148328224e4,generalTicketCount:2,productId:1,productName:"전시1",reservationType:1,totalPrice:1e4,youthTicketCount:2},{id:2,childTicketCount:0,displayEnd:148405984e4,displayStart:148328224e4,generalTicketCount:3,productId:1,productName:"전시1",reservationType:1,totalPrice:15e3,youthTicketCount:1}],2:[{id:3,childTicketCount:1,displayEnd:148405984e4,displayStart:148328224e4,generalTicketCount:0,productId:2,productName:"전시2",reservationType:1,totalPrice:2e4,youthTicketCount:2}],3:[{id:4,childTicketCount:1,displayEnd:148405984e4,displayStart:148328224e4,generalTicketCount:2,productId:3,productName:"전시3",reservationType:1,totalPrice:3e4,youthTicketCount:0}],4:[{childTicketCount:1,displayEnd:148405984e4,displayStart:148328224e4,generalTicketCount:2,productId:4,productName:"전시4",reservationType:1,totalPrice:4e4,youthTicketCount:2}]}},cardItems=[],cardData=[],MySummary=function(){function t(){e.html(Handlebars.templates.mySummary(a))}var e=$(".my_summary"),n={canceledReservationCount:0,completedReservationCount:0,scheduledReservationCount:0,totalReservationCount:0},a={};return{init:function(e){a=$.extend({},n,e),t()},updateSummary:function(t){a.canceledReservationCount++,a.scheduledReservationCount--,e.find(".item:eq(1) span").text(a.scheduledReservationCount),e.find(".item:last span").text(a.canceledReservationCount)}}}(),CardItem=extend(eg.Component,{init:function(t,e){this.myReservation=e,this.$root=$(t),this.$popupBookingWrapper=$(".popup_booking_wrapper"),this.listHeaders={$proccessingReservationList:$("li.card:eq(0)"),$confirmedReservationList:$("li.card:eq(1)"),$usedReservationList:$("li.card:eq(2)"),$canceledReservationList:$("li.card:eq(3)")},this.$root.find(".btn.btn_cancel").on("click",this.fadeInPopup.bind(this)),this.$root.find(".btn.btn_review").on("click",this.goReviewWrite.bind(this))},goReviewWrite:function(t){t.preventDefault();var e=this.myReservation.productId;$("body").data("user-id");window.location.href="/products/"+e+"/comments/form"},fadeInPopup:function(t){t.preventDefault(),this.updateCancelPopup(),this.$popupBookingWrapper.fadeIn(),this.cancelMyReservationHandler=this.cancelMyReservation.bind(this),this.fadeOutPopupHandler=this.fadeOutPopup.bind(this),this.$popBottomBtnArea=this.$popupBookingWrapper.find(".pop_bottom_btnarea"),this.$popupBookingWrapper.on("click",".popup_btn_close",this.fadeOutPopupHandler),this.$popBottomBtnArea.on("click",".btn_green, .btn_gray",this.fadeOutPopupHandler),this.$popBottomBtnArea.on("click",".btn_green",this.cancelMyReservationHandler)},updateCancelPopup:function(){this.$popupBookingWrapper.find(".pop_tit > span").text(this.myReservation.productName),this.$popupBookingWrapper.find(".pop_tit > small").text(this.myReservation.displayPeriod)},cancelMyReservation:function(t){t.preventDefault(),this.$popBottomBtnArea.off("click",".btn_green",this.cancelMyReservationHandler),MySummary.updateSummary(this.myReservation.type),this.sendMyReservationUpdateRequest(),this.$root.find(".booking_cancel").remove(),this.$root.appendTo("li.card.used:last"),$.each(this.listHeaders,function(t,e){0===e.find("article").length&&e.hide()})},fadeOutPopup:function(t){t.preventDefault(),this.$popupBookingWrapper.fadeOut()},sendMyReservationUpdateRequest:function(){var t="/api/reservations/"+this.myReservation.id;$.ajax(t,{type:"PUT"}).then(function(){console.log("update success!")})}}),MyReservationModule=function(){function t(t){var e=0,n=$.map(t,function(t,n){if(t>0)return e+=t,n+"("+t+")"}).join(",");return n+=" - 합계("+e+")"}function e(e,a){var i=new Date(a.displayStart),o=new Date(a.displayEnd);a.displayPeriod=n(i,o),a.formattedTotalPrice=Number(a.totalPrice).toLocaleString("ko");var l=t({"일반":a.generalTicketCount,"청소년":a.youthTicketCount,"어린이":a.childTicketCount});return a.formattedReservationContents=l,e===r.NOT_USED_RESERVATION||e===r.CONFIRMED_RESERVATION?(a.btnCancelText="취소",a.btnCancelTextClass="btn_cancel"):e===r.USED_RESERVATION&&(a.btnCancelText="예매자 리뷰 남기기",a.btnCancelTextClass="btn_review"),a}function n(t,e){return t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()+"("+l[t.getDay()]+")~"+e.getFullYear()+"."+(e.getMonth()+1)+"."+e.getDate()+"("+l[e.getDay()]+")"}function a(t){s=$.extend({},reservatinosForTest,t),MySummary.init(s)}function i(){var t=s.reservations;if(s.totalReservationCount>0){var n=!0,a=!1,i=void 0;try{for(var o,r=Object.entries(t)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=_slicedToArray(o.value,2),c=l[0],d=l[1],u=!0,p=!1,m=void 0;try{for(var f,h=d[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var v=f.value;e(c,v),cardData.push(v)}}catch(t){p=!0,m=t}finally{try{!u&&h.return&&h.return()}finally{if(p)throw m}}var g="li.card:eq("+(c-1)+")";$(g).append(t[c].map(function(t,e){return Handlebars.templates.reservationCardItem(t)}).join(""))}}catch(t){a=!0,i=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}$(".card:not(:has(article))").hide(),$(".wrap_mylist").show()}else $(".err").show()}function o(){$.each($(".card_item"),function(t){cardItems[t]=new CardItem,cardItems[t].init(this,cardData[t])})}window.location.pathname;var r={NOT_USED_RESERVATION:"1",CONFIRMED_RESERVATION:"2",USED_RESERVATION:"3",CANCELD_RESERVATION:"4"},l=($("body").data("user-id"),["일","월","화","수","목","금","토"]),c="/api/reservations",s={};return{init:function(){$.ajax(c,{type:"GET"}).then(a).then(i).then(o)}}}();TicketValidator.prototype=new eg.Component,TicketValidator.prototype.constructor=TicketValidator,TicketValidator.prototype.validate=function(){var t=/0\d{1,2}-\d{3,4}-\d{4}/,e=/[0-9a-zA-Z]+@[0-9a-zA-Z]+\.[0-9a-zA-Z]+/;Number(validator.elementMap.$totalCnt.html())>0&&!!validator.elementMap.$name.val()&&t.test(validator.elementMap.$tel.val())&&e.test(validator.elementMap.$email.val())&&validator.elementMap.$chkAgree.prop("checked")?(validator.elementMap.$wrapBtnBk.removeClass("disable"),validator.elementMap.$btnBk.prop("disabled",!1)):(validator.elementMap.$wrapBtnBk.addClass("disable"),validator.elementMap.$btnBk.prop("disabled",!0))};var validator=new TicketValidator;validator.on("validate",validator.validate),Ticket.prototype=new eg.Component,Ticket.prototype.constructor=Ticket,Ticket.prototype.getElementMap=function(t){var e=t.closest(".qty"),n=e.find(".count_control_input"),a=$(".total_cnt");return{$qty:e,$cnt:n,$totalPrice:e.find(".total_price"),price:e.find(".discounted-price").html(),cnt:Number(n.val()),$plusBtn:e.find(".ico_plus3"),$minusBtn:e.find(".ico_minus3"),$totalCnt:a,totalCnt:Number(a.html())}},Ticket.prototype.add=function(t){console.log("add"),t.$cnt.val(t.cnt+1),t.$totalPrice.html(t.price*(t.cnt+1)),t.$totalCnt.html(t.totalCnt+1)},Ticket.prototype.sub=function(t){console.log("sub"),t.$cnt.val(t.cnt-1),t.$totalPrice.html(t.price*(t.cnt-1)),t.$totalCnt.html(t.totalCnt-1)},Ticket.prototype.activeMinusState=function(t){console.log("activeMinusState"),t.$minusBtn.removeClass("disabled"),t.$cnt.removeClass("disabled"),t.$totalPrice.closest(".individual_price").addClass("on_color")},Ticket.prototype.inactiveMinusState=function(t){console.log("inactiveMinusState"),t.$minusBtn.addClass("disabled"),t.$cnt.addClass("disabled"),t.$totalPrice.closest(".individual_price").removeClass("on_color")};var ticket=new Ticket;ticket.on("add",function(t){var e=ticket.getElementMap(t);0===e.cnt&&ticket.activeMinusState(e),ticket.add(e),validator.trigger("validate")}),ticket.on("sub",function(t){var e=ticket.getElementMap(t);1===e.cnt&&ticket.inactiveMinusState(e),ticket.sub(e),validator.trigger("validate")});var Reserve=function(){var t,e,n=$(".ct_wrap"),a=$(".ticket_body"),i=$(".total_cnt"),o=$(".display_time"),r=$("#name"),l=$("#tel"),c=$("#email"),s=$("#chk3"),d=$(".btn_agreement"),u=$(".bk_btn_wrap"),p=$(".bk_btn"),m=function(){var t=$(".btn_plus_minus.ico_plus3"),e=$(".btn_plus_minus.ico_minus3");t.on("click",function(t){ticket.trigger("add",$(this)),t.preventDefault()}),e.on("click",function(t){$(this).hasClass("disabled")||ticket.trigger("sub",$(this)),t.preventDefault()})},f=function(){$.ajax({url:"/api/products/"+t+"/prices",type:"GET"}).done(function(t){var e="",n="",o=Handlebars.compile($("#ticket-template").html());$.each(t,function(t,a){var i,r;2===a.priceType?(i="청소년",r="(만 13~18세)"):3===a.priceType?(i="어린이",r="(만 4~12세)"):(i="일반",r="(만 19~64세)"),a.type=i,a.typeDesc=r,a.discountedPrice=a.price*(1-a.discountRate),a.discountPercentage=100*a.discountRate,e+=a.type+a.typeDesc+" "+a.price+"원<br>",n+=o(a)}),$(".store_details p.dsc:last-child").append(e),a.append(n),m(),validator.elementMap={$totalCnt:i,$name:r,$tel:l,$email:c,$chkAgree:s,$wrapBtnBk:u,$btnBk:p}}).fail(function(t){console.log(t.responseJSON),alert("Price list load를 실패했습니다.")})},h=function(e){$.ajax({url:"/api/products/"+t+"/mainImage",type:"GET"}).done(function(t){e.imgId=t;var a=new Date(e.displayStart),i=new Date(e.displayEnd);e.displayStartDate=a.getFullYear()+"년 "+(a.getMonth()+1)+"월 "+a.getDate()+"일",e.displayEndDate=i.getFullYear()+"년 "+(i.getMonth()+1)+"월 "+i.getDate()+"일";var r=Handlebars.compile($("#reservation-info-template").html());n.prepend(r(e)),o.html(a.getMonth()+1+"."+a.getDate()+"~"+(i.getMonth()+1)+"."+i.getDate()),f()}).fail(function(t){console.log(t.responseJSON),alert("Product main image id load를 실패했습니다.")})},v=function(){$.ajax({url:"/api/products/"+t+"/reservationInfo",type:"GET"}).done(h).fail(function(t){console.log(t.responseJSON),alert("Product reservation information load를 실패했습니다.")})},g=function(){var n=$(".qty[data-type=1] .count_control_input").val(),a=$(".qty[data-type=2] .count_control_input").val(),i=$(".qty[data-type=3] .count_control_input").val(),o=JSON.stringify({productId:t,userId:e,generalTicketCount:void 0===n?0:n,youthTicketCount:void 0===a?0:a,childTicketCount:void 0===i?0:i,reservationName:r.val(),reservationTel:l.val(),reservationEmail:c.val(),reservationDate:new Date,reservationType:1});console.log(o),$.ajax({url:"/api/reservations",type:"POST",data:o,contentType:"application/json"}).done(function(t){alert("예약을 성공했습니다."),location.href="/myreservation"}).fail(function(t){console.log(t.responseJSON),alert("Reservation create를 실패했습니다.")})};return{init:function(){t=$("#container").data("id"),e=$("#container").data("userid"),v(),r.on("keyup",function(t){validator.trigger("validate")}),l.on("keyup",function(t){validator.trigger("validate")}),c.on("keyup",function(t){validator.trigger("validate")}),d.on("click",function(t){$(this).closest(".agreement").addClass("open"),t.preventDefault()}),s.on("click",function(){validator.trigger("validate")}),p.on("click",function(){console.log("예약완료"),g()})}}}();$(Reserve.init),$(function(){Comment.init()});var Comment=function(){var t=!0,e=$(".photo_list"),n=$(".index_photo"),a=$("#photoviwer"),i=$(".review_header .title").text(),o=new function(){this.page=1,this.limit=10,this.getPage=function(){return this.page},this.pageUp=function(){this.page++},this.pageDown=function(){this.page--},this.getLimit=function(){return this.limit}},r=new Flicking(e,{width:$(window).width(),intervalFlag:!1,afterFlickFn:function(){n.html(this.$list.data("curItem"))}});r.swipedetect(e);var l=function(t,n){$.ajax({url:"/api/comments/"+$(n.target).closest("li").data("id")+"/images",type:"GET"}).done(function(n){e.empty(),e.data("curItem",1);var i=Handlebars.templates.photoViewerTemplate(n);e.append(i),$(".total_photo").html(n.length),a.css({width:$(document).width(),height:$(document).height()}),a.fadeIn(),t()}).fail(function(t){console.log("eee"),console.log(t.responseJSON),alert("Comment photos load를 실패했습니다.")})},c=function(t){var e=$(".grade_area");e.find(".grade_value").css("width",(t.avgScore/5*100).toFixed()),e.find(".text_value > span").text(t.avgScore.toFixed(1)),e.find(".join_count > em.green").text(t.num+"건")},s=function(t){var e=window.location.origin+"/api"+window.location.pathname,n={};n.type="GET",n.data={page:this.getPage(),limit:this.getLimit()};var i=$.ajax(e,n);i.then(p),i.then(function(){$(".thumb").on("click",l.bind(this,r.listInit.bind(r))),$(".btnPhotoviwerExit").on("click",function(){a.fadeOut()})}),i.then(function(){this.pageUp()}.bind(this))},d=function(){var t="/api"+window.location.pathname+"/summary",e={type:"GET"};$.ajax(t,e).then(c)},u=function(t,e){var n=$(".list_item");n.length>10&&t&&n.slice(0,10).remove()},p=function(e){u.call(this,e,!0);var n=$.map(e,function(t){t.productName=i;var e=new Date(t.createDate),n=e.getFullYear()+"."+(e.getMonth()+1)+"."+e.getDate();return t.date=n,Handlebars.templates.userCommentItem(t)}).join("");$(".list_short_review").append(n),t=!0},m=function(){var e=Math.round($(document).scrollTop()),n=$(document).height(),a=$(window).height();t&&e===n-a&&(t=!1,s.call(o,!0))};return{init:function(){console.log(o),s.call(o),d(),$(window).on("scroll",m)}}}(),ReviewWrite=function(){var t,e,n,a=!1,i=$(".rating"),o=$(".review_write_info"),r=$(".review_textarea"),l=$("#reviewImageFileOpenInput"),c=$(".lst_thumb"),s=$(".bk_btn"),d=function(t,e){$.ajax({url:"/api/images/"+e,type:"DELETE"}).done(function(){t.remove()}).fail(function(t){console.log(t.responseJSON),alert("Image delete를 실패했습니다.")})},u=function(t){t.find("a.anchor").on("click",function(t){t.preventDefault(),$li=$(t.target).closest("li.item"),d($li,$li.data("id"))})},p=function(t){var e=Handlebars.compile($("#images-template").html());c.append(e(t)),u(c)},m=function(t){$.ajax({url:"/api/images",type:"POST",data:t,processData:!1,contentType:!1}).done(function(t){p(t),l.val("")}).fail(function(t){console.log(t.responseJSON),alert("Image upload를 실패했습니다.")})},f=function(e){var a=r.val(),i=n.score(),o=[];c.children("li.item").each(function(t,e){o.push($(e).data("id"))});var l=JSON.stringify({comment:a,score:i,fileIds:o});$.ajax({url:"/api/products/"+t+"/comments/form",type:"POST",data:l,contentType:"application/json"}).done(function(){location.href="/myreservation"}).fail(function(t){console.log(t.responseJSON),alert("Comment create를 실패했습니다.")})};return{init:function(){t=$("#container").data("productid"),e=$("#container").data("userid"),(n=new Rating($(".star_rank"),{afterSetScore:function(){this._$root.removeClass("gray_star")}})).on("change",function(t){n.setScore(t.score)}),i.on("click","input[type=checkbox]",function(t){var e=$(t.target).val();n.trigger("change",{score:e}),$.each($(t.target).siblings("input[type=checkbox]").addBack(),function(t,n){var a=$(n).val()<=e;$(n).prop("checked",a)})}),o.on("click",function(t){$(t.target).closest(".review_write_info").addClass("hide"),r.focus()}),r.on("focusout",function(t){$(t.target).val()||o.removeClass("hide")}),l.on("change",function(t){var e=t.target.files,n=new FormData;if(c.children("li.item").length+e.length>5)alert("이미지는 최대 5개 업로드 가능합니다.");else{for(var i=0;i<e.length;i++)e[i].size>1024e3?a=!0:n.append("files",e[i]);m(n),a&&(alert("이미즈 최대 사이즈는 1MB 입니다."),a=!1)}}),s.on("click",f)}}}();$(ReviewWrite.init),function(){var t=Handlebars.template,e=Handlebars.templates=Handlebars.templates||{};e.mySummary=t({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,i){var o,r=null!=e?e:t.nullContext||{},l=n.helperMissing,c=t.escapeExpression;return'<ul class="summary_board">\r\n    <li class="item">\r\n        \x3c!--[D] 선택 후 .on 추가 link_summary_board --\x3e\r\n        <a href="#" class="link_summary_board on">\r\n            <i class="spr_book2 ico_book2"></i>\r\n            <em class="tit">전체</em>\r\n            <span class="figure">'+c("function"===(void 0===(o=null!=(o=n.totalReservationCount||(null!=e?e.totalReservationCount:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"totalReservationCount",hash:{},data:i}):o)+'</span>\r\n        </a>\r\n    </li>\r\n    <li class="item">\r\n        <a href="#" class="link_summary_board">\r\n            <i class="spr_book2 ico_book_ss"></i>\r\n            <em class="tit">이용예정</em>\r\n            <span class="figure">'+c("function"===(void 0===(o=null!=(o=n.scheduledReservationCount||(null!=e?e.scheduledReservationCount:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"scheduledReservationCount",hash:{},data:i}):o)+'</span>\r\n        </a>\r\n    </li>\r\n    <li class="item">\r\n        <a href="#" class="link_summary_board">\r\n            <i class="spr_book2 ico_check"></i>\r\n            <em class="tit">이용완료</em>\r\n            <span class="figure">'+c("function"===(void 0===(o=null!=(o=n.completedReservationCount||(null!=e?e.completedReservationCount:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"completedReservationCount",hash:{},data:i}):o)+'</span>\r\n        </a>\r\n    </li>\r\n    <li class="item">\r\n        <a href="#" class="link_summary_board">\r\n            <i class="spr_book2 ico_back"></i>\r\n            <em class="tit">취소·환불</em>\r\n            <span class="figure">'+c("function"===(void 0===(o=null!=(o=n.canceledReservationCount||(null!=e?e.canceledReservationCount:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"canceledReservationCount",hash:{},data:i}):o)+"</span>\r\n        </a>\r\n    </li>\r\n</ul>\r\n"},useData:!0}),e.nolist=t({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,i){return'<div class="err">\r\n    <i class="spr_book ico_info_nolist"></i>\r\n    <h1 class="tit">예약 리스트가 없습니다</h1>\r\n</div>'},useData:!0}),e.photoViewerTemplate=t({1:function(t,e,n,a,i){return'    <li style="display:inline-block; width:100%; height:100%; text-align:center;">\r\n        <img src="http://220.230.112.236/api/images/'+t.escapeExpression(t.lambda(e,e))+'" style="max-width:100%; max-hegiht:100%;">\r\n    </li>\r\n'},compiler:[7,">= 4.0.0"],main:function(t,e,n,a,i){var o;return null!=(o=n.each.call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?o:""},useData:!0}),e.reservationCardItem=t({1:function(t,e,n,a,i){var o,r=null!=e?e:t.nullContext||{},l=n.helperMissing,c=t.escapeExpression;return'                    <div class="booking_cancel">\r\n                        <button class="btn '+c("function"===(void 0===(o=null!=(o=n.btnCancelTextClass||(null!=e?e.btnCancelTextClass:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"btnCancelTextClass",hash:{},data:i}):o)+'">\r\n                                <span>'+c("function"===(void 0===(o=null!=(o=n.btnCancelText||(null!=e?e.btnCancelText:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"btnCancelText",hash:{},data:i}):o)+"</span>\r\n                        </button>\r\n                    </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,n,a,i){var o,r,l=null!=e?e:t.nullContext||{},c=n.helperMissing,s="function",d=t.escapeExpression;return'<article class="card_item">\r\n    <a href="#" class="link_booking_details">\r\n        <div class="card_body">\r\n            <div class="left"></div>\r\n            <div class="middle">\r\n                <div class="card_detail">\r\n                    <em class="booking_number">No.'+d((void 0===(r=null!=(r=n.id||(null!=e?e.id:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"id",hash:{},data:i}):r)+'</em>\r\n                    <h4 class="tit">'+d((void 0===(r=null!=(r=n.productName||(null!=e?e.productName:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"productName",hash:{},data:i}):r)+'</h4>\r\n                    <ul class="detail">\r\n                        <li class="item">\r\n                            <span class="item_tit">일정</span>\r\n                            <em class="item_dsc"> '+d((void 0===(r=null!=(r=n.displayPeriod||(null!=e?e.displayPeriod:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"displayPeriod",hash:{},data:i}):r)+' </em></li>\r\n                        <li class="item">\r\n                            <span class="item_tit">내역</span>\r\n                            <em class="item_dsc"> '+d((void 0===(r=null!=(r=n.formattedReservationContents||(null!=e?e.formattedReservationContents:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"formattedReservationContents",hash:{},data:i}):r)+' </em></li>\r\n                        <li class="item">\r\n                            <span class="item_tit">상품</span>\r\n                            <em class="item_dsc"> '+d((void 0===(r=null!=(r=n.productName||(null!=e?e.productName:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"productName",hash:{},data:i}):r)+' </em></li>\r\n                    </ul>\r\n                    <div class="price_summary">\r\n                        <span class="price_tit">결제 예정금액</span>\r\n                        <em class="price_amount"> <span>'+d((void 0===(r=null!=(r=n.formattedTotalPrice||(null!=e?e.formattedTotalPrice:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"formattedTotalPrice",hash:{},data:i}):r)+'</span> <span class="unit">원</span></em>\r\n                    </div>\r\n                    \x3c!-- [D] 예약 신청중, 예약 확정 만 취소가능, 취소 버튼 클릭 시 취소 팝업 활성화 --\x3e\r\n'+(null!=(o=n.if.call(l,null!=e?e.btnCancelText:e,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?o:"")+'                </div>\r\n            </div>\r\n            <div class="right"></div>\r\n        </div>\r\n        <div class="card_footer">\r\n            <div class="left"></div>\r\n            <div class="middle"></div>\r\n            <div class="right"></div>\r\n        </div>\r\n    </a>\r\n    <a href="#" class="fn fn-share1 naver-splugin btn_goto_share" title="공유하기"></a>\r\n</article>\r\n'},useData:!0}),e.userCommentItem=t({1:function(t,e,n,a,i){return" no_img"},3:function(t,e,n,a,i){var o,r=null!=e?e:t.nullContext||{},l=n.helperMissing,c=t.escapeExpression;return'                <div class="thumb_area">\r\n                    <a href="#" class="thumb" title="이미지 크게 보기">\r\n                        <img width="90" height="90" class="img_vertical_top"\r\n                             src="http://220.230.112.236/api/images/'+c("function"===(void 0===(o=null!=(o=n.fileId||(null!=e?e.fileId:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"fileId",hash:{},data:i}):o)+'"\r\n                             alt="리뷰이미지">\r\n                    </a> <span class="img_count">'+c("function"===(void 0===(o=null!=(o=n.filesNum||(null!=e?e.filesNum:e))?o:l)?"undefined":_typeof(o))?o.call(r,{name:"filesNum",hash:{},data:i}):o)+"</span>\r\n                </div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,n,a,i){var o,r,l=null!=e?e:t.nullContext||{},c=n.helperMissing,s="function",d=t.escapeExpression;return'<li class="list_item" data-id="'+d((void 0===(r=null!=(r=n.id||(null!=e?e.id:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"id",hash:{},data:i}):r)+'">\r\n    <div>\r\n        <div class="review_area'+(null!=(o=n.unless.call(l,null!=e?e.fileId:e,{name:"unless",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?o:"")+'">\r\n'+(null!=(o=n.if.call(l,null!=e?e.fileId:e,{name:"if",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i}))?o:"")+'            <h4 class="resoc_name">'+d((void 0===(r=null!=(r=n.productName||(null!=e?e.productName:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"productName",hash:{},data:i}):r)+'</h4>\r\n            <p class="review">'+d((void 0===(r=null!=(r=n.comment||(null!=e?e.comment:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"comment",hash:{},data:i}):r)+'</p>\r\n        </div>\r\n        <div class="info_area">\r\n            <div class="review_info">\r\n                <span class="grade">'+d((void 0===(r=null!=(r=n.score||(null!=e?e.score:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"score",hash:{},data:i}):r)+'</span>\r\n                <span class="name">'+d((void 0===(r=null!=(r=n.snsId||(null!=e?e.snsId:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"snsId",hash:{},data:i}):r)+'</span>\r\n                <span class="date">'+d((void 0===(r=null!=(r=n.date||(null!=e?e.date:e))?r:c)?"undefined":_typeof(r))===s?r.call(l,{name:"date",hash:{},data:i}):r)+" 방문</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</li>"},useData:!0})}();var Rating=extend(eg.Component,{init:function(t,e){this._$root=t,this.afterSetScore=e.afterSetScore},score:function(){return this._$root.html()},setScore:function(t){this._$root.html(t),this.afterSetScore&&this.afterSetScore()}});